<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot IAM - Assistant Intelligent</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .logo i {
            margin-right: 0.5rem;
            color: #ffd700;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-type-selector {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 0.5rem 1rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-type-selector:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .auth-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #ffd700;
            color: #333;
        }

        .btn-secondary {
            background: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .main-container {
            flex: 1;
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            gap: 2rem;
            width: 100%;
        }

        .sidebar {
            width: 300px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1.5rem;
            height: fit-content;
        }

        .sidebar h3 {
            color: white;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature-list {
            list-style: none;
        }

        .feature-list li {
            padding: 0.75rem 0;
            color: rgba(255, 255, 255, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature-list li:hover {
            color: white;
            padding-left: 0.5rem;
        }

        .chat-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: between;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #00ff00;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            max-height: 500px;
        }

        .message {
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .bot-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .user-avatar {
            background: #ffd700;
            color: #333;
        }

        .message-content {
            max-width: 70%;
            padding: 1rem 1.25rem;
            border-radius: 20px;
            position: relative;
        }

        .bot-message {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-bottom-left-radius: 8px;
        }

        .user-message {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 8px;
        }

        .chat-input-container {
            padding: 1.5rem;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            padding: 0.75rem 1.25rem;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
            resize: none;
            min-height: 44px;
            max-height: 120px;
        }

        .chat-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .send-btn {
            width: 44px;
            height: 44px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .quick-action {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            color: #667eea;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .quick-action:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .typing-indicator {
            display: none;
            padding: 1rem 1.25rem;
            color: #666;
            font-style: italic;
        }

        .typing-dots {
            display: inline-flex;
            gap: 3px;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: scale(1); }
            30% { transform: scale(1.5); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            margin-left: auto;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                padding: 1rem;
            }
            
            .sidebar {
                width: 100%;
                order: 2;
            }
            
            .header {
                padding: 1rem;
            }
            
            .user-menu {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <i class="fas fa-graduation-cap"></i>
            Chatbot IAM
        </div>
        <div class="user-menu">
            <select class="user-type-selector" id="userType">
                <option value="prospect">üë§ Prospect</option>
                <option value="student">üéì √âtudiant</option>
                <option value="admin">‚öôÔ∏è Administrateur</option>
            </select>
            <div class="auth-buttons">
                <button class="btn btn-secondary" onclick="openModal('loginModal')">
                    <i class="fas fa-sign-in-alt"></i> Connexion
                </button>
                <button class="btn btn-primary" onclick="openModal('registerModal')">
                    <i class="fas fa-user-plus"></i> Inscription
                </button>
            </div>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <h3>
                <i class="fas fa-list-ul"></i>
                <span id="sidebarTitle">Fonctionnalit√©s Prospects</span>
            </h3>
            <ul class="feature-list" id="featureList">
                <!-- Contenu dynamique selon le type d'utilisateur -->
            </ul>
        </aside>

        <main class="chat-container">
            <div class="chat-header">
                <div>
                    <h2>Assistant IAM</h2>
                    <small id="userTypeDisplay">Mode Prospect</small>
                </div>
                <div class="chat-status">
                    <div class="status-dot"></div>
                    <span>En ligne</span>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="message">
                    <div class="message-avatar bot-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content bot-message">
                        <p>Bonjour ! Je suis votre assistant IAM. Comment puis-je vous aider aujourd'hui ?</p>
                        <div class="quick-actions" id="quickActions">
                            <!-- Actions rapides dynamiques -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                L'assistant tape
                <span class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </span>
            </div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea 
                        class="chat-input" 
                        id="messageInput" 
                        placeholder="Tapez votre message..."
                        rows="1"></textarea>
                    <button class="send-btn" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de connexion -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Connexion</h3>
                <button class="close-modal" onclick="closeModal('loginModal')">&times;</button>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> Se connecter
                </button>
            </form>
        </div>
    </div>

    <!-- Modal d'inscription -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Inscription</h3>
                <button class="close-modal" onclick="closeModal('registerModal')">&times;</button>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerName">Nom complet</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerPhone">T√©l√©phone</label>
                    <input type="tel" id="registerPhone" required>
                </div>
                <div class="form-group">
                    <label for="registerType">Type d'utilisateur</label>
                    <select id="registerType" required>
                        <option value="">S√©lectionner...</option>
                        <option value="prospect">Prospect</option>
                        <option value="student">√âtudiant</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Mot de passe</label>
                    <input type="password" id="registerPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-user-plus"></i> S'inscrire
                </button>
            </form>
        </div>
    </div>

    <script>
        // Configuration des fonctionnalit√©s par type d'utilisateur
        const userFeatures = {
            prospect: {
                title: 'Fonctionnalit√©s Prospects',
                display: 'Mode Prospect',
                features: [
                    { icon: 'fas fa-book', text: 'Informations formations', action: 'getFormations' },
                    { icon: 'fas fa-euro-sign', text: 'Prix et modalit√©s', action: 'getPricing' },
                    { icon: 'fas fa-file-alt', text: 'Processus inscription', action: 'getInscription' },
                    { icon: 'fas fa-map-marker-alt', text: 'Contact et localisation', action: 'getContact' },
                    { icon: 'fas fa-envelope', text: 'Demande d\'information', action: 'requestInfo' },
                    { icon: 'fas fa-user-plus', text: 'Pr√©-inscription', action: 'preRegister' }
                ],
                quickActions: [
                    'Voir les formations',
                    'Tarifs 2025',
                    'Comment s\'inscrire ?',
                    'Prendre rendez-vous'
                ]
            },
            student: {
                title: 'Espace √âtudiant',
                display: 'Mode √âtudiant',
                features: [
                    { icon: 'fas fa-chart-line', text: 'Mes notes', action: 'getGrades' },
                    { icon: 'fas fa-credit-card', text: 'Suivi paiements', action: 'getPayments' },
                    { icon: 'fas fa-exclamation-circle', text: 'R√©clamations', action: 'getReclamations' },
                    { icon: 'fas fa-calendar', text: 'Emploi du temps', action: 'getSchedule' },
                    { icon: 'fas fa-book-open', text: 'Ressources p√©dagogiques', action: 'getResources' },
                    { icon: 'fas fa-comments', text: 'Contact administration', action: 'contactAdmin' }
                ],
                quickActions: [
                    'Mes derni√®res notes',
                    '√âtat des paiements',
                    'Cr√©er une r√©clamation',
                    'Emploi du temps'
                ]
            },
            admin: {
                title: 'Panel Administrateur',
                display: 'Mode Administrateur',
                features: [
                    { icon: 'fas fa-users', text: 'Gestion utilisateurs', action: 'manageUsers' },
                    { icon: 'fas fa-chart-bar', text: 'Statistiques chatbot', action: 'getStats' },
                    { icon: 'fas fa-tasks', text: 'Gestion r√©clamations', action: 'manageReclamations' },
                    { icon: 'fas fa-cog', text: 'Configuration r√©ponses', action: 'configureBot' },
                    { icon: 'fas fa-bell', text: 'Notifications syst√®me', action: 'getNotifications' },
                    { icon: 'fas fa-database', text: 'Sauvegarde donn√©es', action: 'backupData' }
                ],
                quickActions: [
                    'Nouveaux utilisateurs',
                    'R√©clamations en attente',
                    'Statistiques du jour',
                    'Configuration'
                ]
            }
        };

        let currentUserType = 'prospect';
        let isLoggedIn = false;
        let currentUser = null;

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateUserInterface();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Changement de type d'utilisateur
            document.getElementById('userType').addEventListener('change', function(e) {
                currentUserType = e.target.value;
                updateUserInterface();
            });

            // Auto-resize textarea
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // Envoi par Enter
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Gestion des formulaires
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
        }

        function updateUserInterface() {
            const config = userFeatures[currentUserType];
            
            // Mise √† jour du titre de la sidebar
            document.getElementById('sidebarTitle').innerHTML = `<i class="fas fa-list-ul"></i> ${config.title}`;
            document.getElementById('userTypeDisplay').textContent = config.display;
            
            // Mise √† jour de la liste des fonctionnalit√©s
            const featureList = document.getElementById('featureList');
            featureList.innerHTML = config.features.map(feature => 
                `<li onclick="executeAction('${feature.action}')">
                    <i class="${feature.icon}"></i>
                    ${feature.text}
                </li>`
            ).join('');
            
            // Mise √† jour des actions rapides
            const quickActions = document.getElementById('quickActions');
            quickActions.innerHTML = config.quickActions.map(action => 
                `<span class="quick-action" onclick="sendQuickMessage('${action}')">${action}</span>`
            ).join('');
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Ajouter le message de l'utilisateur
            addMessage(message, 'user');
            input.value = '';
            input.style.height = 'auto';
            
            // Simuler la r√©ponse du bot
            showTypingIndicator();
            setTimeout(() => {
                hideTypingIndicator();
                const response = generateBotResponse(message);
                addMessage(response, 'bot');
            }, 1500);
        }

        function sendQuickMessage(message) {
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatarClass = sender === 'user' ? 'user-avatar' : 'bot-avatar';
            const avatarIcon = sender === 'user' ? 'fas fa-user' : 'fas fa-robot';
            const messageClass = sender === 'user' ? 'user-message' : 'bot-message';
            
            messageDiv.innerHTML = `
                <div class="message-avatar ${avatarClass}">
                    <i class="${avatarIcon}"></i>
                </div>
                <div class="message-content ${messageClass}">
                    <p>${content}</p>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            const config = userFeatures[currentUserType];
            
            // R√©ponses contextuelles selon le type d'utilisateur
            if (currentUserType === 'prospect') {
                if (lowerMessage.includes('formation') || lowerMessage.includes('cours')) {
                    return "Nous proposons plusieurs formations : Informatique, Gestion, Marketing Digital, et Comptabilit√©. Souhaitez-vous plus de d√©tails sur une formation sp√©cifique ?";
                }
                if (lowerMessage.includes('prix') || lowerMessage.includes('tarif')) {
                    return "Nos tarifs varient selon la formation. Par exemple : Informatique (500 000 FCFA/an), Gestion (400 000 FCFA/an). Souhaitez-vous un devis personnalis√© ?";
                }
                if (lowerMessage.includes('inscription')) {
                    return "Pour vous inscrire : 1) Remplissez le formulaire de pr√©-inscription, 2) Fournissez les documents requis, 3) Effectuez le paiement initial. Voulez-vous commencer ?";
                }
            } else if (currentUserType === 'student') {
                if (lowerMessage.includes('note') || lowerMessage.includes('r√©sultat')) {
                    return "Vos derni√®res notes : Math√©matiques (15/20), Informatique (17/20), Anglais (14/20). Moyenne g√©n√©rale : 15.3/20. F√©licitations !";
                }
                if (lowerMessage.includes('paiement')) {
                    return "√âtat de vos paiements : Trimestre 1 (Pay√©), Trimestre 2 (Pay√©), Trimestre 3 (En attente - 150 000 FCFA). Date limite : 30 juin 2025.";
                }
                if (lowerMessage.includes('emploi du temps')) {
                    return "Votre emploi du temps de cette semaine : Lundi 8h-12h (Maths), Mardi 14h-18h (Informatique), Mercredi 8h-12h (Anglais). Consultez l'app mobile pour plus de d√©tails.";
                }
            } else if (currentUserType === 'admin') {
                if (lowerMessage.includes('statistique')) {
                    return "Statistiques du jour : 45 conversations, 12 nouvelles inscriptions, 8 r√©clamations trait√©es. Taux de satisfaction : 94%.";
                }
                if (lowerMessage.includes('r√©clamation')) {
                    return "R√©clamations en attente : 3 (Haute priorit√©), 7 (Normale). Derni√®re r√©clamation : Probl√®me de connexion - √âtudiant ID #1234.";
                }
            }
            
            return "Je comprends votre demande. Pouvez-vous √™tre plus sp√©cifique pour que je puisse mieux vous aider ?";
        }

        function executeAction(action) {
            const actions = {
                getFormations: () => sendQuickMessage("Quelles sont les formations disponibles ?"),
                getPricing: () => sendQuickMessage("Quels sont vos tarifs ?"),
                getInscription: () => sendQuickMessage("Comment s'inscrire ?"),
                getContact: () => sendQuickMessage("O√π √™tes-vous situ√©s ?"),
                requestInfo: () => openModal('requestInfoModal'),
                preRegister: () => openModal('preRegisterModal'),
                getGrades: () => sendQuickMessage("Afficher mes notes"),
                getPayments: () => sendQuickMessage("√âtat de mes paiements"),
                getReclamations: () => sendQuickMessage("Mes r√©clamations"),
                getSchedule: () => sendQuickMessage("Mon emploi du temps"),
                getResources: () => sendQuickMessage("Ressources p√©dagogiques"),
                contactAdmin: () => sendQuickMessage("Contacter l'administration"),
                manageUsers: () => sendQuickMessage("Gestion des utilisateurs"),
                getStats: () => sendQuickMessage("Statistiques du chatbot"),
                manageReclamations: () => sendQuickMessage("G√©rer les r√©clamations"),
                configureBot: () => sendQuickMessage("Configuration du bot")
            };
            
            if (actions[action]) {
                actions[action]();
            }
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simulation de connexion
            if (email && password) {
                isLoggedIn = true;
                currentUser = {
                    email: email,
                    name: email.split('@')[0],
                    type: currentUserType
                };
                
                updateAuthInterface();
                closeModal('loginModal');
                addMessage(`Bienvenue ${currentUser.name} ! Vous √™tes maintenant connect√© en tant que ${currentUserType}.`, 'bot');
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const formData = {
                name: document.getElementById('registerName').value,
                email: document.getElementById('registerEmail').value,
                phone: document.getElementById('registerPhone').value,
                type: document.getElementById('registerType').value,
                password: document.getElementById('registerPassword').value
            };
            
            // Simulation d'inscription
            if (Object.values(formData).every(val => val)) {
                isLoggedIn = true;
                currentUser = {
                    name: formData.name,
                    email: formData.email,
                    type: formData.type
                };
                
                updateAuthInterface();
                closeModal('registerModal');
                addMessage(`Inscription r√©ussie ! Bienvenue ${currentUser.name}. Votre compte ${formData.type} a √©t√© cr√©√© avec succ√®s.`, 'bot');
            }
        }

        function updateAuthInterface() {
            const authButtons = document.querySelector('.auth-buttons');
            if (isLoggedIn) {
                authButtons.innerHTML = `
                    <div style="color: white; margin-right: 1rem;">
                        <i class="fas fa-user"></i> ${currentUser.name}
                    </div>
                    <button class="btn btn-secondary" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> D√©connexion
                    </button>
                `;
            } else {
                authButtons.innerHTML = `
                    <button class="btn btn-secondary" onclick="openModal('loginModal')">
                        <i class="fas fa-sign-in-alt"></i> Connexion
                    </button>
                    <button class="btn btn-primary" onclick="openModal('registerModal')">
                        <i class="fas fa-user-plus"></i> Inscription
                    </button>
                `;
            }
        }

        function logout() {
            isLoggedIn = false;
            currentUser = null;
            updateAuthInterface();
            addMessage("Vous avez √©t√© d√©connect√©. √Ä bient√¥t !", 'bot');
        }

        // Fermeture des modals en cliquant √† l'ext√©rieur
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Simulation d'API calls pour les fonctionnalit√©s avanc√©es
        const apiSimulator = {
            getFormations: async () => {
                return [
                    { id: 1, name: "Informatique", duration: "3 ans", price: "500000 FCFA" },
                    { id: 2, name: "Gestion", duration: "2 ans", price: "400000 FCFA" },
                    { id: 3, name: "Marketing Digital", duration: "1 an", price: "300000 FCFA" }
                ];
            },
            
            getStudentGrades: async (studentId) => {
                return [
                    { subject: "Math√©matiques", grade: 15, max: 20, date: "2025-05-15" },
                    { subject: "Informatique", grade: 17, max: 20, date: "2025-05-10" },
                    { subject: "Anglais", grade: 14, max: 20, date: "2025-05-08" }
                ];
            },
            
            getPaymentStatus: async (studentId) => {
                return {
                    total: 500000,
                    paid: 350000,
                    remaining: 150000,
                    nextDueDate: "2025-06-30",
                    status: "En cours"
                };
            },
            
            getAdminStats: async () => {
                return {
                    totalUsers: 1250,
                    activeChats: 45,
                    newRegistrations: 12,
                    pendingClaims: 8,
                    satisfactionRate: 94
                };
            }
        };

        // Fonctions d'int√©gration avec le backend
        async function callAPI(endpoint, data = null) {
            try {
                const response = await fetch(`/api/${endpoint}`, {
                    method: data ? 'POST' : 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': isLoggedIn ? `Bearer ${currentUser.token}` : ''
                    },
                    body: data ? JSON.stringify(data) : null
                });
                
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                // Fallback sur les donn√©es simul√©es
                return null;
            }
        }

        // Gestion des notifications
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div style="background: rgba(255,255,255,0.95); padding: 1rem; border-radius: 10px; 
                           box-shadow: 0 5px 15px rgba(0,0,0,0.2); margin: 1rem; position: fixed; 
                           top: 20px; right: 20px; z-index: 1001; max-width: 300px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>${message}</span>
                        <button onclick="this.parentElement.parentElement.remove()" 
                                style="background: none; border: none; font-size: 1.2rem; cursor: pointer;">√ó</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Fonctionnalit√©s avanc√©es du chatbot
        function handleAdvancedQuery(message) {
            const intent = detectIntent(message);
            
            switch (intent) {
                case 'schedule_appointment':
                    return handleAppointmentScheduling();
                case 'file_complaint':
                    return handleComplaintFiling();
                case 'payment_info':
                    return handlePaymentInquiry();
                case 'grade_inquiry':
                    return handleGradeInquiry();
                default:
                    return generateContextualResponse(message);
            }
        }

        function detectIntent(message) {
            const intents = {
                'rendez-vous|appointment|rdv': 'schedule_appointment',
                'r√©clamation|plainte|probl√®me': 'file_complaint',
                'paiement|facture|frais': 'payment_info',
                'note|r√©sultat|bulletin': 'grade_inquiry'
            };
            
            for (const [pattern, intent] of Object.entries(intents)) {
                if (new RegExp(pattern, 'i').test(message)) {
                    return intent;
                }
            }
            return 'general';
        }

        function handleAppointmentScheduling() {
            const appointmentForm = `
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px; margin-top: 1rem;">
                    <h4>üìÖ Prendre un rendez-vous</h4>
                    <form onsubmit="submitAppointment(event)">
                        <div style="margin: 0.5rem 0;">
                            <label>Date souhait√©e:</label>
                            <input type="date" id="appointmentDate" min="${new Date().toISOString().split('T')[0]}" required>
                        </div>
                        <div style="margin: 0.5rem 0;">
                            <label>Heure pr√©f√©r√©e:</label>
                            <select id="appointmentTime" required>
                                <option value="">S√©lectionner...</option>
                                <option value="09:00">09:00</option>
                                <option value="10:00">10:00</option>
                                <option value="11:00">11:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:00">15:00</option>
                                <option value="16:00">16:00</option>
                            </select>
                        </div>
                        <div style="margin: 0.5rem 0;">
                            <label>Motif:</label>
                            <textarea id="appointmentReason" placeholder="D√©crivez bri√®vement le motif de votre rendez-vous..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Confirmer le rendez-vous</button>
                    </form>
                </div>
            `;
            return "Je vais vous aider √† prendre un rendez-vous. Veuillez remplir les informations ci-dessous :" + appointmentForm;
        }

        function submitAppointment(event) {
            event.preventDefault();
            const appointmentData = {
                date: document.getElementById('appointmentDate').value,
                time: document.getElementById('appointmentTime').value,
                reason: document.getElementById('appointmentReason').value
            };
            
            showNotification('Rendez-vous confirm√© ! Vous recevrez une confirmation par email.', 'success');
            addMessage(`‚úÖ Votre rendez-vous a √©t√© programm√© pour le ${appointmentData.date} √† ${appointmentData.time}. Motif: ${appointmentData.reason}`, 'bot');
        }

        // Gestion des r√©clamations
        function handleComplaintFiling() {
            if (!isLoggedIn) {
                return "Vous devez √™tre connect√© pour d√©poser une r√©clamation. Veuillez vous connecter d'abord.";
            }
            
            const complaintForm = `
                <div style="background: #fff3cd; padding: 1rem; border-radius: 10px; margin-top: 1rem; border-left: 4px solid #ffc107;">
                    <h4>üìù D√©poser une r√©clamation</h4>
                    <form onsubmit="submitComplaint(event)">
                        <div style="margin: 0.5rem 0;">
                            <label>Type de r√©clamation:</label>
                            <select id="complaintType" required>
                                <option value="">S√©lectionner...</option>
                                <option value="academic">Probl√®me acad√©mique</option>
                                <option value="administrative">Probl√®me administratif</option>
                                <option value="payment">Probl√®me de paiement</option>
                                <option value="technical">Probl√®me technique</option>
                                <option value="other">Autre</option>
                            </select>
                        </div>
                        <div style="margin: 0.5rem 0;">
                            <label>Priorit√©:</label>
                            <select id="complaintPriority" required>
                                <option value="low">Faible</option>
                                <option value="medium" selected>Moyenne</option>
                                <option value="high">√âlev√©e</option>
                                <option value="urgent">Urgente</option>
                            </select>
                        </div>
                        <div style="margin: 0.5rem 0;">
                            <label>Description d√©taill√©e:</label>
                            <textarea id="complaintDescription" rows="4" placeholder="D√©crivez votre probl√®me en d√©tail..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Soumettre la r√©clamation</button>
                    </form>
                </div>
            `;
            return "Je vais vous aider √† d√©poser votre r√©clamation. Veuillez fournir les d√©tails :" + complaintForm;
        }

        function submitComplaint(event) {
            event.preventDefault();
            const complaintData = {
                type: document.getElementById('complaintType').value,
                priority: document.getElementById('complaintPriority').value,
                description: document.getElementById('complaintDescription').value,
                user: currentUser.name,
                timestamp: new Date().toISOString()
            };
            
            const ticketNumber = 'REC' + Date.now().toString().slice(-6);
            showNotification(`R√©clamation enregistr√©e avec le num√©ro: ${ticketNumber}`, 'success');
            addMessage(`‚úÖ Votre r√©clamation a √©t√© enregistr√©e avec le num√©ro: ${ticketNumber}. Vous serez contact√© sous 24-48h selon la priorit√©.`, 'bot');
        }

        // Syst√®me de recherche intelligente
        function performSearch(query) {
            const searchResults = {
                formations: [
                    "Formation en Informatique - 3 ans - 500,000 FCFA",
                    "Formation en Gestion - 2 ans - 400,000 FCFA",
                    "Formation Marketing Digital - 1 an - 300,000 FCFA"
                ],
                procedures: [
                    "Processus d'inscription en 3 √©tapes",
                    "Modalit√©s de paiement flexibles",
                    "Documents requis pour l'inscription"
                ],
                contact: [
                    "Adresse: Dakar, S√©n√©gal",
                    "T√©l√©phone: +221 XX XXX XXXX",
                    "Email: info@iam-school.sn"
                ]
            };
            
            const query_lower = query.toLowerCase();
            let results = [];
            
            if (query_lower.includes('formation') || query_lower.includes('cours')) {
                results = results.concat(searchResults.formations);
            }
            if (query_lower.includes('inscription') || query_lower.includes('procedure')) {
                results = results.concat(searchResults.procedures);
            }
            if (query_lower.includes('contact') || query_lower.includes('adresse')) {
                results = results.concat(searchResults.contact);
            }
            
            return results.length > 0 ? results : ["Aucun r√©sultat trouv√© pour votre recherche."];
        }

        // Am√©lioration de l'exp√©rience utilisateur
        function addTypingEffect(element, text, speed = 50) {
            element.innerHTML = '';
            let i = 0;
            const typeInterval = setInterval(() => {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                } else {
                    clearInterval(typeInterval);
                }
            }, speed);
        }

        // Sauvegarde de la conversation
        function saveConversation() {
            const messages = Array.from(document.querySelectorAll('.message')).map(msg => ({
                content: msg.querySelector('.message-content p').textContent,
                sender: msg.classList.contains('user') ? 'user' : 'bot',
                timestamp: new Date().toISOString()
            }));
            
            const conversationData = {
                user: currentUser ? currentUser.name : 'Anonyme',
                userType: currentUserType,
                messages: messages,
                timestamp: new Date().toISOString()
            };
            
            // Sauvegarde en m√©moire (simulation)
            window.conversationHistory = window.conversationHistory || [];
            window.conversationHistory.push(conversationData);
            
            showNotification('Conversation sauvegard√©e avec succ√®s !', 'success');
        }

        // Ajout d'options contextuelles dans le menu
        function addContextMenu() {
            const contextMenu = document.createElement('div');
            contextMenu.innerHTML = `
                <div style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
                    <div style="background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); 
                               border-radius: 15px; padding: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                        <h4 style="margin-bottom: 0.5rem; color: #333;">Actions rapides</h4>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <button class="btn btn-secondary" onclick="saveConversation()" style="font-size: 0.9rem;">
                                <i class="fas fa-save"></i> Sauvegarder
                            </button>
                            <button class="btn btn-secondary" onclick="clearChat()" style="font-size: 0.9rem;">
                                <i class="fas fa-trash"></i> Effacer
                            </button>
                            <button class="btn btn-secondary" onclick="exportChat()" style="font-size: 0.9rem;">
                                <i class="fas fa-download"></i> Exporter
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(contextMenu);
        }

        function clearChat() {
            if (confirm('√ätes-vous s√ªr de vouloir effacer toute la conversation ?')) {
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message">
                        <div class="message-avatar bot-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content bot-message">
                            <p>Bonjour ! Je suis votre assistant IAM. Comment puis-je vous aider aujourd'hui ?</p>
                            <div class="quick-actions" id="quickActions">
                                ${userFeatures[currentUserType].quickActions.map(action => 
                                    `<span class="quick-action" onclick="sendQuickMessage('${action}')">${action}</span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function exportChat() {
            const messages = Array.from(document.querySelectorAll('.message')).map(msg => {
                const sender = msg.classList.contains('user') ? 'Vous' : 'Assistant IAM';
                const content = msg.querySelector('.message-content p').textContent;
                return `${sender}: ${content}`;
            }).join('\n\n');
            
            const blob = new Blob([messages], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `conversation-iam-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Conversation export√©e avec succ√®s !', 'success');
        }

        // Initialisation des fonctionnalit√©s avanc√©es
        setTimeout(() => {
            addContextMenu();
        }, 2000);

        // Service Worker pour les notifications (simulation)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(console.error);
        }
    </script>
</body>
</html>